<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1, shrink-to-fit=no" />
    <meta name="go-import" content="kubevirt.io/kubevirt git https://github.com/kubevirt/kubevirt">
    <meta name="go-import" content="kubevirt.io/containerized-data-importer git https://github.com/kubevirt/containerized-data-importer">
    <meta name="description" content="Virtual Machine Management on Kubernetes
">
    <title>VirtualMachineInstanceReplicaSet</title>

    <link rel="apple-touch-icon" sizes="72x72" href="/assets/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
    <link rel="manifest" href="/assets/favicon/site.webmanifest">
    <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#00aba9">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://www.kubevirt.io//docs/workloads/controllers/virtual-machine-replica-set.html">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
</head>


  <body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" role="navigation">
        <a class="navbar-brand" href="/">
    <img src="/assets/images/KubeVirt_logo_color.svg" class="navbar-brand-image d-inline-block align-top" alt="KubeVirt.io">
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <i class="fas fa-th-large"></i>
  </button>
  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav">
      

      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="/blogs/">Blogs</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="/videos/">Videos</a>
        </li>
      
        <li  class="nav-item active" >
          <a class="nav-link text-uppercase" href="/docs/">Docs</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="/community/">Community</a>
        </li>
      

    </ul>
  </div>

    </nav>

    <main role="main" style="margin-top: 60px;">
      <div class="container-fluid">
        <div class="row">
          <h1 class="page-title offset-lg-1">Docs</h1>
        </div>
        <div class="row">
          <div class="col-sm-12 col-md-4 col-lg-3 offset-lg-1">
            <!-- <div class="search-bar">
              <form action="/search.html" method="get">
                <label for="search-box">Search</label>
                <input type="text" id="search-box" name="query">
                <input type="submit" value="search">
              </form>
            </div> -->
            
  
    <h3 class="docs-title">
      <a href="/docs"  class="docs-title--item" >Introduction</a>
    </h3>
    
  
    <h3 class="docs-title">
      <a href="/docs/installation.html"  class="docs-title--item" >Installation</a>
    </h3>
    
    <ul class="docs-navigation">
      
        <li class="docs-navigation--item">
          <a href="/docs/installation/admission-controllers.html"  class="docs-navigation--item_link" >
            Admission Controllers
          </a>
          
        </li>
      
        <li class="docs-navigation--item">
          <a href="/docs/installation/feature-matrix.html"  class="docs-navigation--item_link" >
            Feature Matrix
          </a>
          
        </li>
      
    </ul>
    
  
    <h3 class="docs-title">
      <a href="/docs/usage.html"  class="docs-title--item" >Usage</a>
    </h3>
    
  
    <h3 class="docs-title">
      <a href="/docs/authorization.html"  class="docs-title--item" >Authorization</a>
    </h3>
    
  
    <h3 class="docs-title">
      <a href="/docs/workloads.html"  class="docs-title--item" >Workloads</a>
    </h3>
    
    <ul class="docs-navigation">
      
        <li class="docs-navigation--item">
          <a href="/docs/workloads/virtual-machines.html"  class="docs-navigation--item_link" >
            Virtual Machines
          </a>
          
            <ul class="docs-navigation_sub">
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/creation.html"  class="docs-navigation_sub--item_link" >
                    Creation
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/node-eviction.html"  class="docs-navigation_sub--item_link" >
                    Node Eviction
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/presets.html"  class="docs-navigation_sub--item_link" >
                    Presets
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/life-cycle.html"  class="docs-navigation_sub--item_link" >
                    Life-cycle
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/dns-for-services.html"  class="docs-navigation_sub--item_link" >
                    DNS for Services and VirtualMachineInstances
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/expose-vm-services.html"  class="docs-navigation_sub--item_link" >
                    Expose VirtualMachineInstances as Services
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/create-networkpolicy.html"  class="docs-navigation_sub--item_link" >
                    Create Networkpolicy
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/graphical-and-console-access.html"  class="docs-navigation_sub--item_link" >
                    Graphical and Console Access
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/disks-and-volumes.html"  class="docs-navigation_sub--item_link" >
                    Disks and Volumes
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/interfaces-networks.html"  class="docs-navigation_sub--item_link" >
                    Interfaces and Networks
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/startup-scripts.html"  class="docs-navigation_sub--item_link" >
                    Startup Scripts
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/guest-os-info.html"  class="docs-navigation_sub--item_link" >
                    Guest Operating System Information
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/virtual-hardware-config.html"  class="docs-navigation_sub--item_link" >
                    Virtualized Hardware Configuration
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/vms-to-nodes.html"  class="docs-navigation_sub--item_link" >
                    Assigning VMs to Nodes
                  </a>
                </li>
            
            </ul>
          
        </li>
      
        <li class="docs-navigation--item">
          <a href="/docs/workloads/controllers.html"  class="docs-navigation--item_link" >
            Controllers
          </a>
          
            <ul class="docs-navigation_sub">
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/controllers/virtualmachine.html"  class="docs-navigation_sub--item_link" >
                    VirtualMachine
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/controllers/virtual-machine-replica-set.html"  class="docs-navigation_sub--item_link active" >
                    VirtualMachineInstanceReplicaSet
                  </a>
                </li>
            
            </ul>
          
        </li>
      
        <li class="docs-navigation--item">
          <a href="/docs/workloads/templates.html"  class="docs-navigation--item_link" >
            Templates
          </a>
          
        </li>
      
        <li class="docs-navigation--item">
          <a href="/docs/workloads/annotations-labels.html"  class="docs-navigation--item_link" >
            Annotations and Labels
          </a>
          
        </li>
      
    </ul>
    
  
    <h3 class="docs-title">
      <a href="/docs/additional-resources.html"  class="docs-title--item" >Additional Resources</a>
    </h3>
    
  


          </div>
          <div class="col-sm-12 col-md-8 col-lg-8 docs">
            <h1 id="virtualmachineinstancereplicaset">VirtualMachineInstanceReplicaSet</h1>

<p>A <em>VirtualMachineInstanceReplicaSet</em> tries to ensures that a specified number of VirtualMachineInstance replicas are running at any time. In other words, a <em>VirtualMachineInstanceReplicaSet</em> makes sure that a VirtualMachineInstance or a homogeneous set of VirtualMachineInstances is always up and ready. It is very similar to a <a href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/">Kubernetes ReplicaSet</a>.</p>

<p>No state is kept and no guarantees about the maximum number of VirtualMachineInstance replicas which are up are given. For example, the <em>VirtualMachineInstanceReplicaSet</em> may decide to create new replicas if possibly still running VMs are entering an unknown state.</p>

<h2 id="how-to-use-a-virtualmachineinstancereplicaset">How to use a VirtualMachineInstanceReplicaSet</h2>

<p>The <em>VirtualMachineInstanceReplicaSet</em> allows us to specify a <em>VirtualMachineInstanceTemplate</em> in <code class="highlighter-rouge">spec.template</code>. It consists of <code class="highlighter-rouge">ObjectMetadata</code> in <code class="highlighter-rouge">spec.template.metadata</code>, and a <code class="highlighter-rouge">VirtualMachineInstanceSpec</code> in <code class="highlighter-rouge">spec.template.spec</code>. The specification of the virtual machine is equal to the specification of the virtual machine in the <code class="highlighter-rouge">VirtualMachineInstance</code> workload.</p>

<p><code class="highlighter-rouge">spec.replicas</code> can be used to specify how many replicas are wanted. If unspecified, the default value is 1. This value can be updated anytime. The controller will react to the changes.</p>

<p><code class="highlighter-rouge">spec.selector</code> is used by the controller to keep track of managed virtual machines. The selector specified there must be able to match the virtual machine labels as specified in <code class="highlighter-rouge">spec.template.metadata.labels</code>. If the selector does not match these labels, or they are empty, the controller will simply do nothing except from logging an error. The user is responsible for not creating other virtual machines or <em>VirtualMachineInstanceReplicaSets</em> which conflict with the selector and the template labels.</p>

<h2 id="exposing-a-virtualmachineinstancereplicaset-as-a-service">Exposing a VirtualMachineInstanceReplicaSet as a Service</h2>

<p>A VirtualMachineInstanceReplicaSet could be exposed as a service. When this is done, one of the VirtualMachineInstances replicas will be picked for the actual delivery of the service.</p>

<p>For example, exposing SSH port (22) as a ClusterIP service using virtctl on a VirtualMachineInstanceReplicaSet:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>virtctl expose vmirs vmi-ephemeral <span class="nt">--name</span> vmiservice <span class="nt">--port</span> 27017 <span class="nt">--target-port</span> 22
</code></pre></div></div>

<p>All service exposure options that apply to a VirtualMachineInstance apply to a VirtualMachineInstanceReplicaSet. See <a href="http://www.kubevirt.io/user-guide/#/workloads/virtual-machines/expose-service">Exposing VirtualMachineInstance</a> for more details.</p>

<h2 id="when-to-use-a-virtualmachineinstancereplicaset">When to use a VirtualMachineInstanceReplicaSet</h2>

<p>Using VirtualMachineInstanceReplicaSet is the right choice when one wants many identical VMs and does not care about maintaining any disk state after the VMs are terminated.</p>

<h3 id="fast-starting-ephemeral-virtual-machines">Fast starting ephemeral Virtual Machines</h3>

<p>This use-case involves small and fast booting VMs with little provisioning performed during initialization.</p>

<p>In this scenario, migrations are not important. Redistributing VM workloads between Nodes can be achieved simply by deleting managed VirtualMachineInstances which are running on an overloaded Node. The <code class="highlighter-rouge">eviction</code> of such a VirtualMachineInstance can happen by directly deleting the VirtualMachineInstance instance (KubeVirt aware workload redistribution) or by deleting the corresponding Pod where the Virtual Machine runs in (Only Kubernetes aware workload redistribution).</p>

<h3 id="slow-starting-ephemeral-virtual-machines">Slow starting ephemeral Virtual Machines</h3>

<p>In this use-case one has big and slow booting VMs, and complex or resource intensive provisioning is done during boot. More specifically, the timespan between the creation of a new VM and it entering the ready state is long.</p>

<p>In this scenario, one still does not care about the state, but since re-provisioning VMs is expensive, migrations are important. Workload redistribution between Nodes can be achieved by migrating VirtualMachineInstances to different Nodes. A workload redistributor needs to be aware of KubeVirt and create migrations, instead of <code class="highlighter-rouge">evicting</code> VirtualMachineInstances by deletion.</p>

<blockquote>
  <p><strong>Note:</strong> The simplest form of having a migratable ephemeral VirtualMachineInstance, will be to use local storage based on <code class="highlighter-rouge">RegistryDisks</code> in combination with a file based backing store. However, migratable backing store support has not landed yet in KubeVirt.</p>
</blockquote>

<h2 id="example">Example</h2>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kubevirt.io/v1alpha2</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">VirtualMachineInstanceReplicaSet</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">testreplicaset</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="s">3</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">myvmi</span><span class="pi">:</span> <span class="s">myvmi</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">test</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">myvmi</span><span class="pi">:</span> <span class="s">myvmi</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">domain</span><span class="pi">:</span>
        <span class="na">devices</span><span class="pi">:</span>
          <span class="na">disks</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">disk</span><span class="pi">:</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">registrydisk</span>
            <span class="na">volumeName</span><span class="pi">:</span> <span class="s">registryvolume</span>
        <span class="na">resources</span><span class="pi">:</span>
          <span class="na">requests</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s">64M</span>
      <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">registryvolume</span>
        <span class="na">registryDisk</span><span class="pi">:</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">kubevirt/cirros-registry-disk-demo:latest</span>
</code></pre></div></div>

<p>Saving this manifest into <code class="highlighter-rouge">testreplicaset.yaml</code> and submitting it to Kubernetes will create three virtual machines based on the template.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl create <span class="nt">-f</span> testreplicaset.yaml
virtualmachineinstancereplicaset <span class="s2">"testreplicaset"</span> created
<span class="nv">$ </span>kubectl describe vmirs testreplicaset
Name:         testreplicaset
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
API Version:  kubevirt.io/v1alpha2
Kind:         VirtualMachineInstanceReplicaSet
Metadata:
  Cluster Name:        
  Creation Timestamp:  2018-01-03T12:42:30Z
  Generation:          0
  Resource Version:    6380
  Self Link:           /apis/kubevirt.io/v1alpha2/namespaces/default/virtualmachineinstancereplicasets/testreplicaset
  UID:                 903a9ea0-f083-11e7-9094-525400ee45b0
Spec:
  Replicas:  3
  Selector:
    Match Labels:
      Myvmi:  myvmi
  Template:
    Metadata:
      Creation Timestamp:  &lt;nil&gt;
      Labels:
        Myvmi:  myvmi
      Name:    <span class="nb">test
    </span>Spec:
      Domain:
        Devices:
          Disks:
            Disk:
            Name:         registrydisk
            Volume Name:  registryvolume
        Resources:
          Requests:
            Memory:  64M
      Volumes:
        Name:  registryvolume
        Registry Disk:
          Image:  kubevirt/cirros-registry-disk-demo:latest
Status:
  Conditions:      &lt;nil&gt;
  Ready Replicas:  2
  Replicas:        3
Events:
  Type    Reason            Age   From                                 Message
  <span class="nt">----</span>    <span class="nt">------</span>            <span class="nt">----</span>  <span class="nt">----</span>                                 <span class="nt">-------</span>
  Normal  SuccessfulCreate  13s   virtualmachineinstancereplicaset-controller  Created virtual machine: testh8998
  Normal  SuccessfulCreate  13s   virtualmachineinstancereplicaset-controller  Created virtual machine: testf474w
  Normal  SuccessfulCreate  13s   virtualmachineinstancereplicaset-controller  Created virtual machine: test5lvkd
</code></pre></div></div>

<p><code class="highlighter-rouge">Replicas</code> is <code class="highlighter-rouge">3</code> and <code class="highlighter-rouge">Ready Replicas</code> is <code class="highlighter-rouge">2</code>. This means that at the moment when showing the status, three Virtual Machines were already created, but only two are running and ready.</p>

          </div>
        </div>
      </div>
    </main>

    <footer class="footer" role="footer">
      <div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-sm-12 col-md-5">
      <p class="privacy-statement text-sm-left" style="text-align: center;">
        &copy; <script type="text/javascript"> document.write(new Date().getFullYear()); </script> KubeVirt | <a href="/privacy" class="privacy-statement-link">Privacy Statement</a>
      </p>
    </div>
    <div class="col-sm-12 col-md-5" style="text-align: center;">
      <p class="text-md-right">
        <a href="https://twitter.com/kubevirt" aria-label="Visit us on Twitter" class="link-social-twitter">
          <i class="fab fa-twitter fa-lg"></i>
        </a>
        <a href="https://github.com/kubevirt" aria-label="View our repo on GitHub" class="link-social-github">
          <i class="fab fa-github fa-lg"></i>
        </a>
        <a href="https://groups.google.com/forum/#!forum/kubevirt-dev" aria-label="Send us an email" class="link-social-mail">
          <i class="fas fa-envelope fa-lg"></i>
        </a>
        <a href="https://calendar.google.com/calendar/embed?src=18pc0jur01k8f2cccvn5j04j1g%40group.calendar.google.com&ctz=Etc%2FGMT"
            aria-label="See our calendar"
            class="link-social-calendar">
          <i class="fas fa-calendar fa-lg"></i>
        </a>
      </p>
    </div>
  </div>
  <div class="row">
    <div class="col offset-md-1 text-sm-left footer-licensing" style="text-align: center;">
      Code licensed under <a href="https://github.com/kubevirt/kubevirt/blob/master/LICENSE">Apache 2.0</a>,
      site under <a href="https://github.com/kubevirt/kubevirt.github.io/blob/master/LICENSE">MIT</a>.
    </div>
  </div>
</div>

    </footer>

    <script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js" integrity="sha384-3LK/3kTpDE/Pkp8gTNp2gR/2gOiwQ6QaO7Td0zV76UFJVhqLl4Vl3KL1We6q6wR9" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <script id="dsq-count-scr" src="//kubevirt-io.disqus.com/count.js" async></script>
    <script src="/js/kubevirt-io.js"></script>
  </body>
</html>
