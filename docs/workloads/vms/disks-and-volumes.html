<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1, shrink-to-fit=no" />
    <meta name="go-import" content="kubevirt.io/kubevirt git https://github.com/kubevirt/kubevirt">
    <meta name="go-import" content="kubevirt.io/containerized-data-importer git https://github.com/kubevirt/containerized-data-importer">
    <meta name="description" content="Virtual Machine Management on Kubernetes
">
    <title>Disks and Volumes</title>

    <link rel="apple-touch-icon" sizes="72x72" href="/assets/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
    <link rel="manifest" href="/assets/favicon/site.webmanifest">
    <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#00aba9">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://www.kubevirt.io//docs/workloads/vms/disks-and-volumes.html">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
</head>


  <body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" role="navigation">
        <a class="navbar-brand" href="/">
    <img src="/assets/images/KubeVirt_logo_color.svg" class="navbar-brand-image d-inline-block align-top" alt="KubeVirt.io">
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <i class="fas fa-th-large"></i>
  </button>
  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav">
      

      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="/blogs/">Blogs</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="/videos/">Videos</a>
        </li>
      
        <li  class="nav-item active" >
          <a class="nav-link text-uppercase" href="/docs/">Docs</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="/community/">Community</a>
        </li>
      

    </ul>
  </div>

    </nav>

    <main role="main" style="margin-top: 60px;">
      <div class="container-fluid">
        <div class="row">
          <h1 class="page-title offset-lg-1">Docs</h1>
        </div>
        <div class="row">
          <div class="col-sm-12 col-md-4 col-lg-3 offset-lg-1">
            <!-- <div class="search-bar">
              <form action="/search.html" method="get">
                <label for="search-box">Search</label>
                <input type="text" id="search-box" name="query">
                <input type="submit" value="search">
              </form>
            </div> -->
            
  
    <h3 class="docs-title">
      <a href="/docs"  class="docs-title--item" >Introduction</a>
    </h3>
    
  
    <h3 class="docs-title">
      <a href="/docs/installation.html"  class="docs-title--item" >Installation</a>
    </h3>
    
    <ul class="docs-navigation">
      
        <li class="docs-navigation--item">
          <a href="/docs/installation/admission-controllers.html"  class="docs-navigation--item_link" >
            Admission Controllers
          </a>
          
        </li>
      
        <li class="docs-navigation--item">
          <a href="/docs/installation/feature-matrix.html"  class="docs-navigation--item_link" >
            Feature Matrix
          </a>
          
        </li>
      
    </ul>
    
  
    <h3 class="docs-title">
      <a href="/docs/usage.html"  class="docs-title--item" >Usage</a>
    </h3>
    
  
    <h3 class="docs-title">
      <a href="/docs/authorization.html"  class="docs-title--item" >Authorization</a>
    </h3>
    
  
    <h3 class="docs-title">
      <a href="/docs/workloads.html"  class="docs-title--item" >Workloads</a>
    </h3>
    
    <ul class="docs-navigation">
      
        <li class="docs-navigation--item">
          <a href="/docs/workloads/virtual-machines.html"  class="docs-navigation--item_link" >
            Virtual Machines
          </a>
          
            <ul class="docs-navigation_sub">
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/creation.html"  class="docs-navigation_sub--item_link" >
                    Creation
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/node-eviction.html"  class="docs-navigation_sub--item_link" >
                    Node Eviction
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/presets.html"  class="docs-navigation_sub--item_link" >
                    Presets
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/life-cycle.html"  class="docs-navigation_sub--item_link" >
                    Life-cycle
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/dns-for-services.html"  class="docs-navigation_sub--item_link" >
                    DNS for Services and VirtualMachineInstances
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/expose-vm-services.html"  class="docs-navigation_sub--item_link" >
                    Expose VirtualMachineInstances as Services
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/create-networkpolicy.html"  class="docs-navigation_sub--item_link" >
                    Create Networkpolicy
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/graphical-and-console-access.html"  class="docs-navigation_sub--item_link" >
                    Graphical and Console Access
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/disks-and-volumes.html"  class="docs-navigation_sub--item_link active" >
                    Disks and Volumes
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/interfaces-networks.html"  class="docs-navigation_sub--item_link" >
                    Interfaces and Networks
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/startup-scripts.html"  class="docs-navigation_sub--item_link" >
                    Startup Scripts
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/guest-os-info.html"  class="docs-navigation_sub--item_link" >
                    Guest Operating System Information
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/virtual-hardware-config.html"  class="docs-navigation_sub--item_link" >
                    Virtualized Hardware Configuration
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/vms/vms-to-nodes.html"  class="docs-navigation_sub--item_link" >
                    Assigning VMs to Nodes
                  </a>
                </li>
            
            </ul>
          
        </li>
      
        <li class="docs-navigation--item">
          <a href="/docs/workloads/controllers.html"  class="docs-navigation--item_link" >
            Controllers
          </a>
          
            <ul class="docs-navigation_sub">
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/controllers/virtualmachine.html"  class="docs-navigation_sub--item_link" >
                    VirtualMachine
                  </a>
                </li>
            
                <li class="docs-navigation_sub--item">
                  <a href="/docs/workloads/controllers/virtual-machine-replica-set.html"  class="docs-navigation_sub--item_link" >
                    VirtualMachineInstanceReplicaSet
                  </a>
                </li>
            
            </ul>
          
        </li>
      
        <li class="docs-navigation--item">
          <a href="/docs/workloads/templates.html"  class="docs-navigation--item_link" >
            Templates
          </a>
          
        </li>
      
        <li class="docs-navigation--item">
          <a href="/docs/workloads/annotations-labels.html"  class="docs-navigation--item_link" >
            Annotations and Labels
          </a>
          
        </li>
      
    </ul>
    
  
    <h3 class="docs-title">
      <a href="/docs/additional-resources.html"  class="docs-title--item" >Additional Resources</a>
    </h3>
    
  


          </div>
          <div class="col-sm-12 col-md-8 col-lg-8 docs">
            <h1 id="disks-and-volumes">Disks and Volumes</h1>

<p>Making persistent storage in the cluster (<strong>volumes</strong>) accessible to VMs consists of three parts. First, volumes are specified in <code class="highlighter-rouge">spec.volumes</code>. Second, disks are added to the VM by specifying them in <code class="highlighter-rouge">spec.domain.devices.disks</code>. Finally, a refererence to the specified volume is added to the disk specification by name.</p>

<h2 id="disks">Disks</h2>

<p>Like all other vmi devices a <code class="highlighter-rouge">spec.domain.devices.disks</code> element has a mandatory <code class="highlighter-rouge">name</code>, and furthermore, it has a mandatory <code class="highlighter-rouge">volumeName</code> entry which references a volume inside <code class="highlighter-rouge">spec.volumes</code>.</p>

<p>A disk can be made accessible via four different types:</p>

<ul>
  <li><strong>disk</strong></li>
  <li><strong>cdrom</strong></li>
  <li><strong>floppy</strong></li>
  <li><strong>lun</strong></li>
</ul>

<p>All possible configuration options are available in the <a href="https://kubevirt.github.io/api-reference/master/definitions.html#_v1_disk">Disk API Reference</a>.</p>

<p>All types, with the exception of <strong>floppy</strong>, allow you to specify the <code class="highlighter-rouge">bus</code> attribute. The <code class="highlighter-rouge">bus</code> attribute determines how the disk will be presented to the guest operating system. <strong>floppy</strong> disks don’t support the <code class="highlighter-rouge">bus</code> attribute: they are always attached to the <code class="highlighter-rouge">fdc</code> bus.</p>

<h3 id="lun">lun</h3>

<p>A <code class="highlighter-rouge">lun</code> disk will expose the volume as a LUN device to the VM. This allows the VM to execute arbitrary iSCSI command passthrough.</p>

<p>A minimal example which attaches a <code class="highlighter-rouge">PersistentVolumeClame</code> named <code class="highlighter-rouge">mypvc</code> as a <code class="highlighter-rouge">lun</code> device to the VM:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">testvmi-lun</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kubevirt.io/v1alpha2</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">VirtualMachineInstance</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">domain</span><span class="pi">:</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s">64M</span>
    <span class="na">devices</span><span class="pi">:</span>
      <span class="na">disks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypvcdisk</span>
        <span class="na">volumeName</span><span class="pi">:</span> <span class="s">mypvc</span>
        <span class="c1"># This makes it a lun device</span>
        <span class="na">lun</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypvc</span>
      <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
        <span class="na">claimName</span><span class="pi">:</span> <span class="s">mypvc</span>
</code></pre></div></div>

<h3 id="disk">disk</h3>

<p>A <code class="highlighter-rouge">disk</code> disk will expose the volume as an ordinary disk to the VM.</p>

<p>A minimal example which attaches a <code class="highlighter-rouge">PersistentVolumeClame</code> named <code class="highlighter-rouge">mypvc</code> as a <code class="highlighter-rouge">disk</code> device to the VM:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">testvmi-disk</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kubevirt.io/v1alpha2</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">VirtualMachineInstance</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">domain</span><span class="pi">:</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s">64M</span>
    <span class="na">devices</span><span class="pi">:</span>
      <span class="na">disks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypvcdisk</span>
        <span class="na">volumeName</span><span class="pi">:</span> <span class="s">mypvc</span>
        <span class="c1"># This makes it a disk</span>
        <span class="na">disk</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypvc</span>
      <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
        <span class="na">claimName</span><span class="pi">:</span> <span class="s">mypvc</span>
</code></pre></div></div>

<p>You can set the disk <code class="highlighter-rouge">bus</code> type, overriding the defaults, which in turn depends on the chipset the VM is configured to use:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">testvmi-disk</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kubevirt.io/v1alpha2</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">VirtualMachineInstance</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">domain</span><span class="pi">:</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s">64M</span>
    <span class="na">devices</span><span class="pi">:</span>
      <span class="na">disks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypvcdisk</span>
        <span class="na">volumeName</span><span class="pi">:</span> <span class="s">mypvc</span>
        <span class="c1"># This makes it a disk</span>
        <span class="na">disk</span><span class="pi">:</span>
          <span class="c1"># This makes it exposed as /dev/vda, being the only and thus first</span>
          <span class="c1"># disk attached to the VM</span>
          <span class="na">bus</span><span class="pi">:</span> <span class="s">virtio</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypvc</span>
      <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
        <span class="na">claimName</span><span class="pi">:</span> <span class="s">mypvc</span>
</code></pre></div></div>

<h3 id="floppy">floppy</h3>

<p>A <code class="highlighter-rouge">floppy</code> disk will expose the volume as a floppy drive to the VM.</p>

<p>A minimal example which attaches a <code class="highlighter-rouge">PersistentVolumeClame</code> named <code class="highlighter-rouge">mypvc</code> as a <code class="highlighter-rouge">floppy</code> device to the VM:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">testvmi-floppy</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kubevirt.io/v1alpha2</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">VirtualMachineInstance</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">domain</span><span class="pi">:</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s">64M</span>
    <span class="na">devices</span><span class="pi">:</span>
      <span class="na">disks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypvcdisk</span>
        <span class="na">volumeName</span><span class="pi">:</span> <span class="s">mypvc</span>
        <span class="c1"># This makes it a floppy</span>
        <span class="na">floppy</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypvc</span>
      <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
        <span class="na">claimName</span><span class="pi">:</span> <span class="s">mypvc</span>
</code></pre></div></div>

<h3 id="cdrom">cdrom</h3>

<p>A <code class="highlighter-rouge">cdrom</code> disk will expose the volume as a cdrom drive to the VM. It is read-only by default.</p>

<p>A minimal example which attaches a <code class="highlighter-rouge">PersistentVolumeClame</code> named <code class="highlighter-rouge">mypvc</code> as a <code class="highlighter-rouge">floppy</code> device to the VM:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">testvmi-cdrom</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kubevirt.io/v1alpha2</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">VirtualMachineInstance</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">domain</span><span class="pi">:</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s">64M</span>
    <span class="na">devices</span><span class="pi">:</span>
      <span class="na">disks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypvcdisk</span>
        <span class="na">volumeName</span><span class="pi">:</span> <span class="s">mypvc</span>
        <span class="c1"># This makes it a cdrom</span>
        <span class="na">cdrom</span><span class="pi">:</span>
          <span class="c1"># This makes the cdrom writeable</span>
          <span class="na">readOnly</span><span class="pi">:</span> <span class="no">false</span>
          <span class="c1"># This makes the cdrom be exposed as SATA device</span>
          <span class="na">bus</span><span class="pi">:</span> <span class="s">sata</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypvc</span>
      <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
        <span class="na">claimName</span><span class="pi">:</span> <span class="s">mypvc</span>
</code></pre></div></div>

<h2 id="volumes">Volumes</h2>

<p>Supported volume sources are</p>

<ul>
  <li><strong>cloudInitNoCloud</strong></li>
  <li><strong>ephemeral</strong></li>
  <li><strong>persistentVolumeClaim</strong></li>
  <li><strong>registryDisk</strong></li>
  <li><strong>emptyDisk</strong></li>
</ul>

<p>All possible configuration options are available in the <a href="https://kubevirt.github.io/api-reference/master/definitions.html#_v1_volume">Volume API Reference</a>.</p>

<h3 id="cloudinitnocloud">cloudInitNoCloud</h3>

<p>Allows attaching <code class="highlighter-rouge">cloudInitNoCloud</code> data-sources to the VM. If the VM contains a proper cloud-init setup, it will pick up the disk as a user-data source.</p>

<p>A simple example which attaches a <code class="highlighter-rouge">Secret</code> as a cloud-init <code class="highlighter-rouge">disk</code> datasource may look like this:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">testvmi-cloudinitnocloud</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kubevirt.io/v1alpha2</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">VirtualMachineInstance</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">domain</span><span class="pi">:</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s">64M</span>
    <span class="na">devices</span><span class="pi">:</span>
      <span class="na">disks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mybootdisk</span>
        <span class="na">volumeName</span><span class="pi">:</span> <span class="s">mypvc</span>
        <span class="na">lun</span><span class="pi">:</span> <span class="pi">{}</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mynoclouddisk</span>
        <span class="na">volumeName</span><span class="pi">:</span> <span class="s">mynocloudvolume</span>
        <span class="na">disk</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypvc</span>
      <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
        <span class="na">claimName</span><span class="pi">:</span> <span class="s">mypvc</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mynoclouddisk</span>
      <span class="na">cloudInitNoCloud</span><span class="pi">:</span>
        <span class="na">secretRef</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">testsecret</span>
</code></pre></div></div>

<h3 id="persistentvolumeclaim">persistentVolumeClaim</h3>

<p>Allows connecting a <code class="highlighter-rouge">PersistentVolumeClaim</code> to a VM disk.</p>

<p>Use a PersistentVolumeClain when the VirtualMachineInstance’s disk needs to persist after the VM terminates. This allows for the VM’s data to remain persistent between restarts.</p>

<p>For KubeVirt to be able to consume the disk present on a PersistentVolume’s filesystem, the disk must be named <code class="highlighter-rouge">disk.img</code> and be placed in the root path of the filesystem. Currently the disk is also required to be in raw format.</p>

<p><strong>Important:</strong> The <code class="highlighter-rouge">disk.img</code> image file needs to be owned by the user-id <code class="highlighter-rouge">107</code> in order to avoid permission issues.</p>

<p>A simple example which attaches a <code class="highlighter-rouge">PersistentVolumeClaim</code> as a <code class="highlighter-rouge">disk</code> may look like this:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">testvmi-pvc</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kubevirt.io/v1alpha2</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">VirtualMachineInstance</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">domain</span><span class="pi">:</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s">64M</span>
    <span class="na">devices</span><span class="pi">:</span>
      <span class="na">disks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypvcdisk</span>
        <span class="na">volumeName</span><span class="pi">:</span> <span class="s">mypvc</span>
        <span class="na">lun</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypvc</span>
      <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
        <span class="na">claimName</span><span class="pi">:</span> <span class="s">mypvc</span>
</code></pre></div></div>

<h3 id="ephemeral">ephemeral</h3>

<p>An ephemeral volume is a local COW (copy on write) image that uses a network volume as a read-only backing store. With an ephemeral volume, the network backing store is never mutated. Instead all writes are stored on the ephemeral image which exists on local storage. KubeVirt dynamically generates the ephemeral images associated with a VM when the VM starts, and discards the ephemeral images when the VM stops.</p>

<p>Ephemeral volumes are useful in any scenario where disk persistence is not desired. The COW image is discarded when VM reaches a final state (e.g., succeeded, failed).</p>

<p>Currently, only <code class="highlighter-rouge">PersistentVolumeClaim</code> may be used as a backing store of the ephemeral volume.</p>

<p>Up-to-date information on supported backing stores can be found in the <a href="http://www.kubevirt.io/api-reference/master/definitions.html#_v1_ephemeralvolumesource">KubeVirt API</a>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">testvmi-ephemeral-pvc</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kubevirt.io/v1alpha2</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">VirtualMachineInstance</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">domain</span><span class="pi">:</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s">64M</span>
    <span class="na">devices</span><span class="pi">:</span>
      <span class="na">disks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypvcdisk</span>
        <span class="na">volumeName</span><span class="pi">:</span> <span class="s">mypvc</span>
        <span class="na">lun</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypvc</span>
      <span class="na">ephemeral</span><span class="pi">:</span>
        <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
          <span class="na">claimName</span><span class="pi">:</span> <span class="s">mypvc</span>
</code></pre></div></div>

<h3 id="registrydisk">registryDisk</h3>

<p>The Registry Disk feature provides the ability to store and distribute VM disks in the container image registry. Registry Disks can be assigned to VMs in the disks section of the VirtualMachineInstance spec.</p>

<p>No network shared storage devices are utilized by Registry Disks. The disks are pulled from the container registry and reside on the local node hosting the VMs that consume the disks.</p>

<h4 id="when-to-use-a-registrydisk">When to use a registryDisk</h4>

<p>Registry Disks are ephemeral storage devices that can be assigned to any number of active VirtualMachineInstances. This makes them an ideal tool for users who want to replicate a large number of VM workloads that do not require persistent data. Registry Disks are commonly used in conjunction with VirtualMachineInstanceReplicaSets.</p>

<h4 id="when-not-to-use-a-registrydisk">When Not to use a registryDisk</h4>

<p>Registry Disks are not a good solution for any workload that requires persistent disks across VM restarts, or workloads that require VM live migration support. It is possible Registry Disks may gain live migration support in the future, but at the moment live migrations are incompatible with Registry Disks.</p>

<h4 id="registrydisk-workflow-example">registryDisk Workflow Example</h4>

<p>Users push VM disks into the container registry using a KubeVirt base image designed to work with the Registry Disk feature. The latest base container image is <strong>kubevirt/registry-disk-v1alpha</strong>.</p>

<p>Using this base image, users can inject a VirtualMachineInstance disk into a container image in a way that is consumable by the KubeVirt runtime. Disks placed into the base container must be placed into the /disk directory. Raw and qcow2 formats are supported. Qcow2 is recommended in order to reduce the container image’s size.</p>

<p>Example: Inject a VirtualMachineInstance disk into a container image.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">cat &lt;&lt; END &gt; Dockerfile</span>
<span class="s">FROM kubevirt/registry-disk-v1alpha</span>
<span class="s">ADD fedora25.qcow2 /disk</span>
<span class="s">END</span>

<span class="s">docker build -t vmidisks/fedora25:latest .</span>
</code></pre></div></div>

<p>Example: Upload the RegistryDisk container image to a registry.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">docker push vmidisks/fedora25:latest</span>
</code></pre></div></div>

<p>Example: Attach the RegistryDisk as an ephemeral disk to a VM.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">testvmi-registrydisk</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kubevirt.io/v1alpha2</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">VirtualMachineInstance</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">domain</span><span class="pi">:</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s">64M</span>
    <span class="na">devices</span><span class="pi">:</span>
      <span class="na">disks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">registrydisk</span>
        <span class="na">volumeName</span><span class="pi">:</span> <span class="s">registryvolume</span>
        <span class="na">disk</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">registryvolume</span>
      <span class="na">registryDisk</span><span class="pi">:</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">vmidisks/fedora25:latest</span>
</code></pre></div></div>

<p>Note that a <code class="highlighter-rouge">registryDisk</code> is file-based and therefore cannot be attached as a <code class="highlighter-rouge">lun</code> device to the VM.</p>

<h3 id="emptydisk">emptyDisk</h3>

<p>An <code class="highlighter-rouge">emptyDisk</code> works similar to an <code class="highlighter-rouge">emptyDir</code> in Kubernetes. An extra sparse <code class="highlighter-rouge">qcow2</code> disk will be allocated and it will live as long as the VM. Thus it will survive guest side VM reboots, but not a VM re-creation. The disk <code class="highlighter-rouge">capacity</code> needs to be specified.</p>

<p>Example: Boot cirros with an extra <code class="highlighter-rouge">emptyDisk</code> with a size of <code class="highlighter-rouge">2GiB</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kubevirt.io/v1alpha2</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">VirtualMachineInstance</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">testvmi-nocloud</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">terminationGracePeriodSeconds</span><span class="pi">:</span> <span class="s">5</span>
  <span class="na">domain</span><span class="pi">:</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s">64M</span>
    <span class="na">devices</span><span class="pi">:</span>
      <span class="na">disks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">registrydisk</span>
        <span class="na">volumeName</span><span class="pi">:</span> <span class="s">registryvolume</span>
        <span class="na">disk</span><span class="pi">:</span>
          <span class="na">bus</span><span class="pi">:</span> <span class="s">virtio</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">emptydisk</span>
        <span class="na">volumeName</span><span class="pi">:</span> <span class="s">emptydiskvolume</span>
        <span class="na">disk</span><span class="pi">:</span>
          <span class="na">bus</span><span class="pi">:</span> <span class="s">virtio</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">registryvolume</span>
      <span class="na">registryDisk</span><span class="pi">:</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">kubevirt/cirros-registry-disk-demo:latest</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">emptydiskvolume</span>
      <span class="na">emptyDisk</span><span class="pi">:</span>
        <span class="na">capacity</span><span class="pi">:</span> <span class="s">2Gi</span>
</code></pre></div></div>

<h4 id="when-to-use-an-emptydisk">When to use an emptyDisk</h4>

<p>Ephemeral VMs very often come with read-only root images and limited tmpfs space. In many cases this is not enough to install application dependencies and provide enough disk space for the application data. While this data is not critical and thus can be lost, it is still needed for the application to function properly during its lifetime. This is where an <code class="highlighter-rouge">emptyDisk</code> can be useful. An emptyDisk is often used and mounted somewhere in <code class="highlighter-rouge">/var/lib</code> or <code class="highlighter-rouge">/var/run</code>.</p>

          </div>
        </div>
      </div>
    </main>

    <footer class="footer" role="footer">
      <div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-sm-12 col-md-5">
      <p class="privacy-statement text-sm-left" style="text-align: center;">
        &copy; <script type="text/javascript"> document.write(new Date().getFullYear()); </script> KubeVirt | <a href="/privacy" class="privacy-statement-link">Privacy Statement</a>
      </p>
    </div>
    <div class="col-sm-12 col-md-5" style="text-align: center;">
      <p class="text-md-right">
        <a href="https://twitter.com/kubevirt" aria-label="Visit us on Twitter" class="link-social-twitter">
          <i class="fab fa-twitter fa-lg"></i>
        </a>
        <a href="https://github.com/kubevirt" aria-label="View our repo on GitHub" class="link-social-github">
          <i class="fab fa-github fa-lg"></i>
        </a>
        <a href="https://groups.google.com/forum/#!forum/kubevirt-dev" aria-label="Send us an email" class="link-social-mail">
          <i class="fas fa-envelope fa-lg"></i>
        </a>
        <a href="https://calendar.google.com/calendar/embed?src=18pc0jur01k8f2cccvn5j04j1g%40group.calendar.google.com&ctz=Etc%2FGMT"
            aria-label="See our calendar"
            class="link-social-calendar">
          <i class="fas fa-calendar fa-lg"></i>
        </a>
      </p>
    </div>
  </div>
  <div class="row">
    <div class="col offset-md-1 text-sm-left footer-licensing" style="text-align: center;">
      Code licensed under <a href="https://github.com/kubevirt/kubevirt/blob/master/LICENSE">Apache 2.0</a>,
      site under <a href="https://github.com/kubevirt/kubevirt.github.io/blob/master/LICENSE">MIT</a>.
    </div>
  </div>
</div>

    </footer>

    <script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js" integrity="sha384-3LK/3kTpDE/Pkp8gTNp2gR/2gOiwQ6QaO7Td0zV76UFJVhqLl4Vl3KL1We6q6wR9" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <script id="dsq-count-scr" src="//kubevirt-io.disqus.com/count.js" async></script>
    <script src="/js/kubevirt-io.js"></script>
  </body>
</html>
